# -*- coding: utf-8 -*-
"""evaluate.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1hYAmDf35ZHcU8i6g30_EAJ3XQcrQJNqG
"""

# src/evaluate.py
import pandas as pd
import joblib
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report
from google.colab import files

# ---------------------------
# 1. Upload trained model
print("Upload your trained model (.pkl):")
uploaded_model = files.upload()
model_filename = list(uploaded_model.keys())[0]
model = joblib.load(model_filename)
print(f"✅ Model '{model_filename}' loaded successfully!")

# ---------------------------
# 2. Upload dataset CSV (must include 'Churn' column)
print("\nUpload dataset CSV for evaluation:")
uploaded_data = files.upload()
data_filename = list(uploaded_data.keys())[0]
df = pd.read_csv(data_filename)
print(f"✅ Dataset '{data_filename}' loaded successfully!")

# ---------------------------
# 3. Split features and target
# Changed 'Churn' to 'Churn_Yes' based on the dataframe columns
X = df.drop('Churn_Yes', axis=1)
y = df['Churn_Yes']

# ---------------------------
# 4. Make predictions
y_pred = model.predict(X)

# ---------------------------
# 5. Evaluate
print("\n✅ Model Evaluation Results:")
print("Accuracy:", accuracy_score(y, y_pred))
print("\nConfusion Matrix:\n", confusion_matrix(y, y_pred))
print("\nClassification Report:\n", classification_report(y, y_pred))

# ---------------------------
# 6. Save results
df['Predicted'] = y_pred
df.to_csv("evaluation_results.csv", index=False)
print("✅ Evaluation results saved as 'evaluation_results.csv'")

# Optional: Download the CSV in Colab
files.download("evaluation_results.csv")